<!DOCTYPE html>
<html>
<head>
    <title>COSMIC ODYSSEY</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css">
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <py_script src="main.py"></py_script>
    <py_script src="story_data.py"></py_script>
    <py_script src="ascii.py"></py_script>
    <py_script src="game_engine.py"></py_script>
    <style>
        body {
            background: linear-gradient(to bottom, #0b0d17 0%, #1a1b2e 100%);
            color: #fff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 128, 255, 0.2);
        }

        h1 {
            text-align: center;
            color: #4a9eff;
            font-size: 2.5em;
            text-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
            margin-bottom: 30px;
        }

        .ascii-art {
            font-family: monospace;
            white-space: pre;
            text-align: center;
            color: #4a9eff;
            margin-bottom: 20px;
            font-size: 0.8em;
            line-height: 1.2;
        }

        .description {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .congratulations {
            text-align: center;
            font-size: 1.5em;
            color: #4CAF50;
            margin: 20px 0;
            padding: 20px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            display: none;
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .star {
            position: fixed;
            background: white;
            border-radius: 50%;
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>COSMIC ODYSSEY</h1>
        <div class="ascii-art" id="scene-art"></div>
        <div class="description" id="scene-description"></div>
        <div class="choices" id="choices-container"></div>
        <div class="congratulations" id="congrats-message"></div>
        <div class="controls">
            <button onclick="saveGame()">Save Game</button>
            <button onclick="loadGame()">Load Game</button>
            <button onclick="restartGame()">Restart Game</button>
        </div>
    </div>

    <script>
        // Add stars to background
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.width = Math.random() * 3 + 'px';
            star.style.height = star.style.width;
            star.style.left = Math.random() * 100 + 'vw';
            star.style.top = Math.random() * 100 + 'vh';
            star.style.animation = `starTwinkle ${Math.random() * 3 + 2}s infinite`;
            document.body.appendChild(star);
        }

        function startGame() {
            fetch('/start_game', { method: 'POST' })
                .then(response => response.json())
                .then(updateGame);
        }

        function makeChoice(choiceIndex) {
            fetch('/make_choice', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ choice: choiceIndex })
            })
            .then(response => response.json())
            .then(updateGame);
        }

        function updateGame(data) {
            if (data.ascii_art) {
                document.getElementById('scene-art').textContent = data.ascii_art;
                document.getElementById('scene-art').style.display = 'block';
            } else {
                document.getElementById('scene-art').style.display = 'none';
            }
            document.getElementById('scene-description').textContent = data.description;
            const choicesContainer = document.getElementById('choices-container');
            choicesContainer.innerHTML = '';

            data.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.onclick = () => makeChoice(index);
                choicesContainer.appendChild(button);
            });

            if (data.is_end) {
                const congrats = document.getElementById('congrats-message');
                congrats.style.display = 'block';
                congrats.textContent = data.congratulations || "Congratulations on completing your cosmic journey!";
            } else {
                document.getElementById('congrats-message').style.display = 'none';
            }
        }

        function saveGame() {
            fetch('/make_choice', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ save: true })
            })
            .then(response => response.json())
            .then(data => alert(data.message));
        }

        function loadGame() {
            fetch('/make_choice', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ load: true })
            })
            .then(response => response.json())
            .then(updateGame);
        }

        function restartGame() {
            if (confirm('Are you sure you want to restart the game?')) {
                startGame();
            }
        }

        // Start the game when page loads
        window.onload = startGame;
    </script>
</body>
</html>